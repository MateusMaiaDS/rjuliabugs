<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Translating Probabilistic Models: From JAGS, Nimble, and Stan to rjuliabugs • rjuliabugs</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Translating Probabilistic Models: From JAGS, Nimble, and Stan to rjuliabugs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">rjuliabugs</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/rjuliabugs.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/other_ppl.html">Translating Probabilistic Models: From JAGS, Nimble, and Stan to rjuliabugs</a></li>
    <li><a class="dropdown-item" href="../articles/rjuliabugs_parallel.html">Using rjuliabugs in parallel</a></li>
    <li><a class="dropdown-item" href="../articles/setup_troubleshooting.html">Using rjuliabugs: Setup and Troubleshooting</a></li>
    <li><a class="dropdown-item" href="../articles/using_bayesplot.html">Plotting rjuliabugs draws using bayesplot package</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Translating Probabilistic Models: From JAGS, Nimble, and Stan to rjuliabugs</h1>
            
      

      <div class="d-none name"><code>other_ppl.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Many R users already work with either probabilistic programming
languages or open statistical software, such as <strong>JAGS</strong>
(Plummer, 2003), <strong>Nimble</strong> (de Valpine et al., 2017,
2024a, 2024b) or <strong>Stan</strong> (Carpenter et al., 2017, Stan;
Stan Development Team., 2024) to fit Bayesian models.<br>
Although each of these tools uses different syntax and inference
algorithms, the <strong>statistical model</strong> is usually similar —
what changes is how the model is expressed and the computational backend
that fits it – including the sampler and the MCMC methodology used to
obtain the posterior.</p>
<p><strong><code>rjuliabugs</code></strong> extends this ecosystem by
providing an interface from R to <strong>JuliaBUGS</strong>, a Julia
implementation of BUGS that also enables the use of advanced samplers
such as Hamiltonian Monte Carlo (HMC) while maintaining the familiar
BUGS syntax. Because JuliaBUGS uses BUGS syntax, any model specified for
<code>JAGS</code> or <code>Nimble</code> can typically be run in
<code>rjuliabugs</code> with little or no modification. Models
originally written in other languages, such as Stan, can also be
<strong>translated</strong> into BUGS form and executed in
<code>rjuliabugs</code>.</p>
<p>In this vignette section, we:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Start with the same model</strong> — the classic <em>Eight
Schools</em> hierarchical model (Rubin, 1981).<br>
</li>
<li>Show it in its original forms for Stan, JAGS, and Nimble, as they
would be run from R.<br>
</li>
<li>Translate each version into equivalent BUGS code for use with
<code>rjuliabugs</code>.<br>
</li>
<li>Compare the outputs to verify that the translation preserves the
statistical meaning of the model.</li>
</ol>
<p>By the end, users familiar with Stan, JAGS, or Nimble will see
exactly how to adapt their existing model code to run with
<code>rjuliabugs</code> while staying entirely in R.</p>
</div>
<div class="section level2">
<h2 id="data-setup">Data Setup<a class="anchor" aria-label="anchor" href="#data-setup"></a>
</h2>
<p>The <em>Eight Schools</em> example evaluates the effects of a
coaching program on SAT scores across eight different schools.<br>
For each school
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mn>8</mn></mrow><annotation encoding="application/x-tex">j = 1, \dots, 8</annotation></semantics></math>,
we have an estimated treatment effect
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>j</mi></msub><annotation encoding="application/x-tex">y_j</annotation></semantics></math>
and its standard error
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>σ</mi><mi>j</mi></msub><annotation encoding="application/x-tex">\sigma_j</annotation></semantics></math>.<br>
The data are as follows:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Setting a seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">42</span><span class="op">)</span></span>
<span></span>
<span><span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">8</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">28</span>, <span class="fl">8</span>, <span class="op">-</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="op">-</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">18</span>, <span class="fl">12</span><span class="op">)</span>          <span class="co"># estimated treatment effects</span></span>
<span><span class="va">sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">15</span>, <span class="fl">10</span>, <span class="fl">16</span>, <span class="fl">11</span>, <span class="fl">9</span>, <span class="fl">11</span>, <span class="fl">10</span>, <span class="fl">18</span><span class="op">)</span>   <span class="co"># standard errors</span></span>
<span><span class="va">data_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span>, y <span class="op">=</span> <span class="va">y</span>, sigma <span class="op">=</span> <span class="va">sigma</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="model-specification">Model Specification<a class="anchor" aria-label="anchor" href="#model-specification"></a>
</h2>
<p>We use a <strong>non-centered parameterization</strong> for the
hierarchical model.<br>
- Observation model:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mi>j</mi></msub><mo>∼</mo><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>j</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>j</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y_j \sim \mbox{Normal}(\theta_j, \sigma_j^2)</annotation></semantics></math><br>
- Non-centered prior:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>θ</mi><mi>j</mi></msub><mo>=</mo><mi>μ</mi><mo>+</mo><mi>τ</mi><mo>⋅</mo><msub><mi>η</mi><mi>j</mi></msub><mo>,</mo><msub><mi>η</mi><mi>j</mi></msub><mo>∼</mo><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\theta_j = \mu + \tau \cdot \eta_j, \eta_j \sim \mbox{Normal}(0,1)</annotation></semantics></math><br>
- Weakly informative priors:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>μ</mi><mo>∼</mo><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mu \sim \mbox{Normal}(0, 10)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>τ</mi><mo>∼</mo><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\tau \sim \mbox{Uniform}(0, 25)</annotation></semantics></math></p>
<p>Summarising the model setup we have:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>y</mi><mi>j</mi></msub><mo>∣</mo><msub><mi>θ</mi><mi>j</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>θ</mi><mi>j</mi></msub><mo>,</mo><msubsup><mi>σ</mi><mi>j</mi><mn>2</mn></msubsup><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mspace width="1.0em"></mspace><mi>j</mi><mo>=</mo><mn>1</mn><mo>,</mo><mi>…</mi><mo>,</mo><mn>8</mn></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><msub><mi>θ</mi><mi>j</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><mi>μ</mi><mo>+</mo><mi>τ</mi><msub><mi>η</mi><mi>j</mi></msub><mo>,</mo><mspace width="1.0em"></mspace><msub><mi>η</mi><mi>j</mi></msub><mo>∼</mo><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>μ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">Normal</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>10</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mi>τ</mi></mtd><mtd columnalign="left" style="text-align: left"><mo>∼</mo><mtext mathvariant="normal">Uniform</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>25</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{aligned}
y_j \mid \theta_j &amp;\sim \mbox{Normal}(\theta_j, \sigma_j^2), \quad j = 1, \dots, 8 \\
\theta_j &amp;= \mu + \tau \eta_j, \quad \eta_j \sim \mbox{Normal}(0,1) \\
\mu &amp;\sim \mbox{Normal}(0, 10) \\
\tau &amp;\sim \mbox{Uniform}(0, 25)
\end{aligned}
</annotation></semantics></math></p>
<p>Now we describe how the hierarchical Eight Schools model can be
defined in different probabilistic programming languages (PPLs) and
accessed from R: <strong>Stan</strong>, <strong>BUGS/JAGS</strong>,
<strong>Nimble</strong>, and <strong>JuliaBUGS</strong>.</p>
<p>For each PPL, we will use their respective R interfaces: <a href="https://cran.r-project.org/web/packages/rstan/index.html" class="external-link"><code>rstan</code></a>
(alternatively <a href="https://github.com/stan-dev/cmdstanr" class="external-link"><code>cmdstanr</code></a>),
<a href="https://cran.r-project.org/package=R2jags" class="external-link"><code>R2jags</code></a>
or <a href="https://cran.r-project.org/web/packages/rjags/index.html" class="external-link"><code>rjags</code></a>,
<a href="https://cran.r-project.org/web/packages/nimble/index.html" class="external-link"><code>nimble</code></a>,
and <a href="https://mateusmaiads.github.io/rjuliabugs/"><code>rjuliabugs</code></a>.</p>
<p>We will also illustrate how to access the <strong>posterior
samples</strong> in R, and provide a small visualization of the
parameter estimates using <a href="https://mc-stan.org/bayesplot/" class="external-link"><code>bayesplot</code></a> for
consistency.</p>
<div class="section level3">
<h3 id="stan-rstan">Stan (<code>rstan</code>)<a class="anchor" aria-label="anchor" href="#stan-rstan"></a>
</h3>
<p>Stan uses a <strong>domain-specific modeling language</strong>.
Models are written as strings (or separate <code>.stan</code> files) and
compiled to C++ for efficient sampling. Minimal modifications are needed
to define priors, likelihood, and transformed parameters.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/rstan/" class="external-link">rstan</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">stan_model_string</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">data {</span></span>
<span><span class="st">  int&lt;lower=0&gt; J;</span></span>
<span><span class="st">  real y[J];</span></span>
<span><span class="st">  real&lt;lower=0&gt; sigma[J];</span></span>
<span><span class="st">}</span></span>
<span><span class="st">parameters {</span></span>
<span><span class="st">  real mu;</span></span>
<span><span class="st">  real&lt;lower=0&gt; tau;</span></span>
<span><span class="st">  vector[J] eta;</span></span>
<span><span class="st">}</span></span>
<span><span class="st">transformed parameters {</span></span>
<span><span class="st">  vector[J] theta = mu + tau * eta;</span></span>
<span><span class="st">}</span></span>
<span><span class="st">model {</span></span>
<span><span class="st">  eta ~ normal(0, 1);</span></span>
<span><span class="st">  y ~ normal(theta, sigma);</span></span>
<span><span class="st">  mu ~ normal(0, 10);</span></span>
<span><span class="st">  tau ~ uniform(0, 25);</span></span>
<span><span class="st">}</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># Fitting the model</span></span>
<span><span class="va">fit_stan</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/rstan/reference/stan.html" class="external-link">stan</a></span><span class="op">(</span>model_code <span class="op">=</span> <span class="va">stan_model_string</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">data_list</span>, </span>
<span>                 iter <span class="op">=</span> <span class="fl">2000</span>, </span>
<span>                 chains <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># To obtain the posterior samples we can use rstan::extract() -- but it is return as a list</span></span>
<span><span class="va">stan_posterior_samples</span> <span class="op">&lt;-</span> <span class="fu">rstan</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/rstan/reference/stanfit-method-extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">fit_stan</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Posterior samples can be accessed via
<code>rstan::extract(fit_stan)</code>. To visualize we use the
<code>bayesplot</code> package.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/bayesplot-colors.html" class="external-link">color_scheme_set</a></span><span class="op">(</span><span class="st">"red"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_areas</a></span><span class="op">(</span><span class="va">fit_stan</span>,pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>,<span class="st">"tau"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="other_ppl_files/figure-html/viz_stan-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="nimble-nimble">Nimble (<code>nimble</code>)<a class="anchor" aria-label="anchor" href="#nimble-nimble"></a>
</h3>
<p>The <code>nimble</code> is even more close to the BUGS syntax. To fit
the it the example, can be seen from the code:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-nimble.org" class="external-link">nimble</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Non-centered Eight Schools model using BUGS syntax</span></span>
<span><span class="va">nimble_model_code</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimbleCode.html" class="external-link">nimbleCode</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">J</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">theta</span><span class="op">[</span><span class="va">j</span><span class="op">]</span>, sd <span class="op">=</span> <span class="va">sigma</span><span class="op">[</span><span class="va">j</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="va">theta</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">mu</span> <span class="op">+</span> <span class="va">tau</span> <span class="op">*</span> <span class="va">eta</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>    <span class="va">eta</span><span class="op">[</span><span class="va">j</span><span class="op">]</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="va">mu</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span></span>
<span>  <span class="va">tau</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">dunif</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">25</span><span class="op">)</span>  </span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Constants</span></span>
<span><span class="va">constants</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>J <span class="op">=</span> <span class="va">J</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Parameters to monitor</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau"</span>, <span class="st">"theta"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build the model</span></span>
<span><span class="va">model_nimble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/nimbleModel.html" class="external-link">nimbleModel</a></span><span class="op">(</span>code <span class="op">=</span> <span class="va">nimble_model_code</span>, data <span class="op">=</span> <span class="va">data_list</span>, constants <span class="op">=</span> <span class="va">constants</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Compile to C++ for speed</span></span>
<span><span class="va">cmodel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/compileNimble.html" class="external-link">compileNimble</a></span><span class="op">(</span><span class="va">model_nimble</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Configure MCMC</span></span>
<span><span class="va">mcmc_conf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/configureMCMC.html" class="external-link">configureMCMC</a></span><span class="op">(</span><span class="va">model_nimble</span>, monitors <span class="op">=</span> <span class="va">params</span><span class="op">)</span></span>
<span><span class="va">cmcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/buildMCMC.html" class="external-link">buildMCMC</a></span><span class="op">(</span><span class="va">mcmc_conf</span><span class="op">)</span></span>
<span><span class="va">cmcmc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/compileNimble.html" class="external-link">compileNimble</a></span><span class="op">(</span><span class="va">cmcmc</span>, project <span class="op">=</span> <span class="va">model_nimble</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run MCMC</span></span>
<span><span class="va">samples</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nimble/man/runMCMC.html" class="external-link">runMCMC</a></span><span class="op">(</span><span class="va">cmcmc</span>, niter <span class="op">=</span> <span class="fl">2000</span>, nchains <span class="op">=</span> <span class="fl">4</span>, nburnin <span class="op">=</span> <span class="fl">500</span>, thin <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># samples is a list of matrices (one per chain)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Convert to array for bayesplot</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="va">samples_array</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">as.array</a></span><span class="op">(</span><span class="va">samples</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Seeing the density plots for mu and tau</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_areas</a></span><span class="op">(</span><span class="va">samples_array</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="other_ppl_files/figure-html/viz_nimble-1.png" width="600" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="jags-rjags">JAGS (<code>rjags</code>)<a class="anchor" aria-label="anchor" href="#jags-rjags"></a>
</h3>
<p>JAGS uses BUGS-style syntax to define hierarchical Bayesian models.
Therefore, it use can be defined below:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># library(R2jags)  # or rjags</span></span>
<span></span>
<span><span class="va">jags_model_string</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">model {</span></span>
<span><span class="st">  for (j in 1:J) {</span></span>
<span><span class="st">    y[j] ~ dnorm(theta[j], pow(sigma[j], -2))</span></span>
<span><span class="st">    theta[j] &lt;- mu + tau * eta[j]</span></span>
<span><span class="st">    eta[j] ~ dnorm(0, 1)</span></span>
<span><span class="st">  }</span></span>
<span><span class="st"></span></span>
<span><span class="st">  mu ~ dnorm(0, 0.01)       # precision = 1/variance</span></span>
<span><span class="st">  tau ~ dunif(0, 25)  </span></span>
<span><span class="st">}</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>,<span class="st">"tau"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Fitting the jags model</span></span>
<span><span class="va">fit_jags</span> <span class="op">&lt;-</span> <span class="fu">jags</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>  parameters.to.save <span class="op">=</span> <span class="va">params</span>,</span>
<span>  model.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/textconnections.html" class="external-link">textConnection</a></span><span class="op">(</span><span class="va">jags_model_string</span><span class="op">)</span>,</span>
<span>  n.chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  n.iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  n.burnin <span class="op">=</span> <span class="fl">500</span>,</span>
<span>  n.thin <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Plotting the results</span></span>
<span><span class="fu">bayesplot</span><span class="fu">::</span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_areas</a></span><span class="op">(</span><span class="va">fit_jags</span><span class="op">$</span><span class="va">BUGSoutput</span><span class="op">$</span><span class="va">sims.array</span><span class="op">[</span>,,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>,<span class="st">"tau"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Omitting the plot for brevity</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="juliabugs-rjuliabugs">JuliaBUGS (<code>rjuliabugs</code>)<a class="anchor" aria-label="anchor" href="#juliabugs-rjuliabugs"></a>
</h3>
<p>For the <code>rjuliabugs</code> as we previous seem in the <a href="https://mateusmaiads.github.io/rjuliabugs/articles/rjuliabugs.html">Get
Started</a> page we can define the <code>rjuliabugs</code> model also
using the BUGS-syntax style. Being more precise, it would be the same
code as the <code>JAGS</code> subsection. The following steps may
differ, by the example below</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mateusmaiads.github.io/rjuliabugs/">rjuliabugs</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rjuliabugs_model_string</span> <span class="op">&lt;-</span> <span class="st">"</span></span>
<span><span class="st">model {</span></span>
<span><span class="st">  for (j in 1:J) {</span></span>
<span><span class="st">    y[j] ~ dnorm(theta[j], pow(sigma[j], -2.0)) # Remember in the rjuliabugs it need to be 2.0</span></span>
<span><span class="st">    theta[j] &lt;- mu + tau * eta[j]</span></span>
<span><span class="st">    eta[j] ~ dnorm(0, 1)</span></span>
<span><span class="st">  }</span></span>
<span><span class="st"></span></span>
<span><span class="st">  mu ~ dnorm(0, 0.01)       </span></span>
<span><span class="st">  tau ~ dunif(0, 25)  </span></span>
<span><span class="st">}</span></span>
<span><span class="st">"</span></span>
<span></span>
<span><span class="co"># Parameters to save</span></span>
<span><span class="va">params</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run JuliaBUGS sampler</span></span>
<span><span class="va">fit_juliabugs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/juliaBUGS.html">juliaBUGS</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">data_list</span>,</span>
<span>  model_def <span class="op">=</span> <span class="va">rjuliabugs_model_string</span>,</span>
<span>  params_to_save <span class="op">=</span> <span class="va">params</span>,</span>
<span>  n_iter <span class="op">=</span> <span class="fl">2000</span>,</span>
<span>  n_chain <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  posterior_type <span class="op">=</span> <span class="st">"array"</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract posterior samples</span></span>
<span><span class="va">rjuliabugs_post_samples</span> <span class="op">&lt;-</span> <span class="fu">rjuliabugs</span><span class="fu">::</span><span class="fu"><a href="../reference/extract.html">extract</a></span><span class="op">(</span><span class="va">fit_juliabugs</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Visualize mu and tau</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/bayesplot/" class="external-link">bayesplot</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://mc-stan.org/bayesplot/reference/MCMC-intervals.html" class="external-link">mcmc_areas</a></span><span class="op">(</span><span class="va">rjuliabugs_post_samples</span>, pars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"mu"</span>, <span class="st">"tau"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="other_ppl_files/figure-html/viz_rjuliabugs-1.png" width="600" style="display: block; margin: auto;"></p>
<p>To summarise, this vignette demonstrated how models originally
written in <code>Stan</code>, <code>Nimble</code>, or <code>JAGS</code>
can be translated and run in <strong>rjuliabugs</strong> with minimal
modifications. The examples focused on the workflow of defining the
model, passing data, running the sampler, and extracting posterior
samples for visualization. The purpose here was <strong>not to compare
the performance of different samplers</strong>, but rather to show how
users familiar with other probabilistic programming languages can
quickly adopt <code>rjuliabugs</code> to leverage Julia’s HMC/NUTS
capabilities directly from <code>R</code>.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Carpenter, B. et al. (2017). Stan: A probabilistic programming
language. Journal of Statistical Software, 76(1). <a href="https://doi.org/10.18637/jss.v076.i01" class="external-link uri">https://doi.org/10.18637/jss.v076.i01</a></p>
<p>Stan Development Team. (2024). “Stan Reference Manual, Version 2.36”.
<a href="https://mc-stan.org" class="external-link uri">https://mc-stan.org</a></p>
<p>Plummer, M. (2003). JAGS: A program for analysis of Bayesian
graphical models using Gibbs sampling. Proceedings of the 3rd
International Workshop on Distributed Statistical Computing.</p>
<p>de Valpine P, Turek D, Paciorek C, Anderson-Bergman C, Temple Lang D,
Bodik R (2017). “Programming with models: writing statistical algorithms
for general model structures with NIMBLE.” Journal of Computational and
Graphical Statistics, 26, 403-413. <a href="doi:10.1080/10618600.2016.1172487" class="uri">doi:10.1080/10618600.2016.1172487</a>.</p>
<ol style="list-style-type: lower-alpha">
<li>de Valpine P, Paciorek C, Turek D, Michaud N, Anderson-Bergman C,
Obermeyer F, Wehrhahn Cortes C, Rodrìguez A, Temple Lang D, Paganin S
(2024a). NIMBLE: MCMC, Particle Filtering, and Programmable Hierarchical
Modeling. <a href="doi:10.5281/zenodo.1211190" class="uri">doi:10.5281/zenodo.1211190</a>, R package version 1.3.0, <a href="https://cran.r-project.org/package=nimble" class="external-link uri">https://cran.r-project.org/package=nimble</a>.</li>
</ol>
<p>de Valpine P, Paciorek C, Turek D, Michaud N, Anderson-Bergman C,
Obermeyer F, Wehrhahn Cortes C, Rodrìguez A, Temple Lang D, Paganin S
(2024b). NIMBLE User Manual. <a href="doi:10.5281/zenodo.1211190" class="uri">doi:10.5281/zenodo.1211190</a>, R package manual version
1.3.0, <a href="https://r-nimble.org" class="external-link uri">https://r-nimble.org</a>.</p>
<p>Rubin, D. B. (1981). Estimation in parallel randomized experiments.
<em>Journal of Educational Statistics</em>, 6(4), 377–401. <a href="https://doi.org/10.3102/10769986006004377" class="external-link uri">https://doi.org/10.3102/10769986006004377</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mateus Maia.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
